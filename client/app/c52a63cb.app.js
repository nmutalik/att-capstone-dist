"use strict";angular.module("attCapstoneApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),angular.module("attCapstoneApp").controller("DashboardCtrl",["$scope","socket","sharedScope",function(a,b,c){}]),angular.module("attCapstoneApp").config(["$stateProvider",function(a){a.state("dashboard",{url:"/",views:{"":{templateUrl:"app/dashboard/dashboard.html"},"main-panel@dashboard":{controller:"MainPanelCtrl",templateUrl:"app/dashboard/mainPanel/mainPanel.html"},"side-panel@dashboard":{controller:"SidePanelCtrl",templateUrl:"app/dashboard/sidePanel/sidePanel.html"}}})}]),angular.module("attCapstoneApp").controller("MainPanelCtrl",["$http","$scope","$timeout","mapService","sharedScope","socket",function(a,b,c,d,e,f){d.initialize(),b.data=e.data;var g={"new":void 0};google.maps.event.addListener(d.map,"bounds_changed",function(){var a=this.getBounds();g={old:g["new"],"new":{ne:{lat:a.getNorthEast().lat(),lng:a.getNorthEast().lng()},sw:{lat:a.getSouthWest().lat(),lng:a.getSouthWest().lng()}}},f.socket.emit("business:diff",g),f.socket.emit("truck:diff",g)}),f.socket.on("business:diff",function(a){h(a,b.data,"business")}),f.socket.on("truck:diff",function(a){h(a,b.data,"truck")}),f.socket.on("truck:save",function(a){d.moveMarker(a)}),f.socket.on("request:save",function(a){b.data.faults.push(a)}),a.get("/api/requests/open").then(function(a){b.data.faults=a.data}),b.selectBusiness=function(a){d.selectBusiness(a)},b.selectTruck=function(a){d.selectTruck(a)},b.dispatchTruck=function(){var c={_business:b.data.selectedBusiness._id,_truck:b.data.selectedBusiness.nearby._id};b.data.selectedBusiness._request.dispatched=!0,a.post("/api/requests/dispatch",c).then(function(c){console.log(c),a.get("/api/requests/open").then(function(a){b.data.faults=a.data})})};var h=function(a,b,c){for(var e in a.add){var f=a.add[e];b[c][f._id]=f,d.plot(c,f)}for(var e in a.remove){var f=a.remove[e];delete b[c][f._id],d.unplot(c,f)}}}]),angular.module("attCapstoneApp").controller("SidePanelCtrl",["$scope","$window","mapService","sharedScope",function(a,b,c,d){a.data=d.data,a.showDoorbell=function(){b.doorbell.show()},a.selectBusiness=function(a){c.selectBusiness(a)},a.selectRequest=function(a){var b=a._business,d=angular.copy(a);delete d._business,b._request=d,c.selectBusiness(b)},a.selectTruck=function(a){c.selectTruck(a)},a.activeState="faults",a.setState=function(b){a.activeState=b},a.flatten=function(a){var b=[];for(var c in a)b.push(a[c]);return b}}]),angular.module("attCapstoneApp").filter("formatLocation",function(){return function(a){if(a){var b=a.lat.toFixed(2);b>0?b=Math.abs(b)+"째 N":0>b&&(b=Math.abs(b)+"째 S");var c=a.lng.toFixed(2);return c>0?c=Math.abs(c)+"째 E":0>c&&(c=Math.abs(c)+"째 W"),b+", "+c}return"unspecified"}}),angular.module("attCapstoneApp").controller("MainCtrl",["$scope","$http","socket",function(a,b,c){a.awesomeThings=[],b.get("/api/things").success(function(b){a.awesomeThings=b,c.syncUpdates("thing",a.awesomeThings)}),a.addThing=function(){""!==a.newThing&&(b.post("/api/things",{name:a.newThing}),a.newThing="")},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)},a.$on("$destroy",function(){c.unsyncUpdates("thing")})}]),angular.module("attCapstoneApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("attCapstoneApp").factory("mapService",["$http","$q","socket","sharedScope",function(a,b,c,d){var e={center:{lat:36.131389,lng:-95.937222},minZoom:2,styles:[{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:"4"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"on"},{saturation:"-100"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:20},{visibility:"on"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.locality",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"on"},{lightness:"80"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"simplified"},{color:"#797979"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:20}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"landscape.natural.landcover",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"landscape.natural.terrain",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfdfdf"},{lightness:21},{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#fed41c"},{visibility:"on"},{weight:"3.00"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#fed41c"},{gamma:"0.6"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{visibility:"on"},{color:"#fed41c"},{weight:"4.00"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{weight:"1"},{gamma:"0.6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#b8b8b8"},{lightness:18},{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#b6b6b6"}]},{featureType:"road.local",elementType:"all",stylers:[{visibility:"on"},{color:"#656565"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#cdcdcd"},{lightness:16}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#b6b6b6"},{visibility:"on"}]},{featureType:"road.local",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#c5c5c5"},{lightness:19},{visibility:"on"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c0d8e3"},{lightness:17},{visibility:"on"}]}],zoom:6},f={business:{scaledSize:new google.maps.Size(24,24),url:"/assets/images/silk/32aed67c.building.png"},fault:{scaledSize:new google.maps.Size(24,24),url:"/assets/images/silk/cea3053e.building_error.png"},truck:{scaledSize:new google.maps.Size(24,24),url:"/assets/images/silk/c4e3244f.car.png"}},g={business:{},truck:{}};return{map:{},initialize:function(){this.map=new google.maps.Map(document.getElementById("map-canvas"),e)},plot:function(a,b){g[a][b._id]=new google.maps.Marker({icon:b._request?f.fault:f[a],id:b._id,map:this.map,position:b.location,title:b.name});var c=this;"business"==a?google.maps.event.addListener(g[a][b._id],"click",function(){c.selectBusiness(b)}):"truck"==a&&google.maps.event.addListener(g[a][b._id],"click",function(){c.selectTruck(b)})},moveMarker:function(a){g.truck[a._id].setPosition(a.location)},selectBusiness:function(c){this.map.panTo(c.location),b.all([a.get("/api/businesses/"+c._id+"/history").then(function(a){c.history=a.data}),a.get("/api/businesses/"+c._id+"/nearby").then(function(a){c.nearby=a.data})]).then(function(){d.data.selectedBusiness=c,d.data.state="business"})},selectTruck:function(b){this.map.panTo(b.location),a.get("/api/trucks/"+b._id+"/history").then(function(a){b.history=a.data,d.data.selectedTruck=b,d.data.state="truck"})},unplot:function(a,b){g[a][b._id].setMap(null),delete g[a][b._id]}}}]),angular.module("attCapstoneApp").factory("sharedScope",["$rootScope",function(a){var b=a.$new(!0);return b.data={business:{},truck:{},faults:[],selectedBusiness:null,state:""},b}]),angular.module("attCapstoneApp").filter("values",function(){return function(a){var b=[];for(var c in a)b.push(a[c]);return b}}),angular.module("attCapstoneApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("attCapstoneApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("attCapstoneApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("attCapstoneApp").run(["$templateCache",function(a){a.put("app/dashboard/dashboard.html",'<div class="fullscreen row"><div class="col-md-3 side-panel" ui-view=side-panel></div><div class="col-md-9 main-panel" ui-view=main-panel></div></div>'),a.put("app/dashboard/mainPanel/mainPanel.html","<div id=map-canvas></div><h2 ng-hide=data.state class=greyed>No Selected Truck or Business</h2><div ng-switch=data.state><div ng-switch-when=business><h2>{{data.selectedBusiness.name}}</h2><div ng-class=\"((typeof(data.selectedBusiness._request) !== 'undefined') ? 'col-md-3' : 'col-md-6')\"><h4>Info</h4><form><div class=form-group><label>location</label><p class=form-control-static>{{data.selectedBusiness.location | formatLocation}}</p></div><div class=form-group><label>address</label><p class=form-control-static>{{data.selectedBusiness.address || \"unspecified\"}}</p></div><div class=form-group><label>phone</label><p class=form-control-static>{{data.selectedBusiness.tel || \"unspecified\"}}</p></div></form></div><div class=\"col-md-4 deploy-frame\" ng-show=\"(typeof(data.selectedBusiness._request) !== 'undefined')\"><h4>Nearest Service Vehicle</h4><form class=flex-form><div class=form-group><label>name</label><p class=form-control-static><a href=# ng-click=selectTruck(data.selectedBusiness.nearby)>{{data.selectedBusiness.nearby.name || \"unspecified\"}}</a></p></div><div class=form-group><label>location</label><p class=form-control-static>{{data.selectedBusiness.nearby.location | formatLocation}}</p></div></form><button ng-disabled=data.selectedBusiness._request.dispatched ng-click=dispatchTruck() class=\"btn btn-primary btn-block hard-corners\">{{(data.selectedBusiness._request.dispatched ? 'Deployed' : 'Deploy')}}</button></div><div ng-class=\"((typeof(data.selectedBusiness._request) !== 'undefined') ? 'col-md-5' : 'col-md-6')\"><h4>History</h4><div class=table-responsive ng-show=data.selectedBusiness.history><table class=\"table table-condensed\"><tr><th>Date</th><th>Type</th><th>Truck</th></tr><tr ng-repeat=\"record in data.selectedBusiness.history | orderBy: '-date'\" title={{record}}><td>{{record.date | date:'short'}}</td><td>{{record.type}}</td><td><a href=# ng-click=selectTruck(record._truck)>{{record._truck.name}}</a></td></tr></table></div><div ng-hide=data.selectedBusiness.history class=greyed>no recorded history</div></div></div><div ng-switch-when=truck><h2>{{data.selectedTruck.name}}</h2><div class=col-md-6><h4>Info</h4><form><div class=form-group><label>location</label><p class=form-control-static>{{data.selectedTruck.location | formatLocation}}</p></div></form></div><div class=col-md-6><h4>History</h4><div class=table-responsive ng-show=data.selectedTruck.history><table class=\"table table-condensed\"><tr><th>Date</th><th>Type</th><th>Business</th></tr><tr ng-repeat=\"record in data.selectedTruck.history | orderBy: '-date'\" title={{record}}><td>{{record.date | date:'short'}}</td><td>{{record.type}}</td><td><a href=# ng-click=selectBusiness(record._business)>{{record._business.name}}</a></td></tr></table></div><div ng-hide=data.selectedTruck.history class=greyed>no recorded history</div></div></div></div>"),a.put("app/dashboard/sidePanel/sidePanel.html","<div class=header><tabset class=side-tab-group justified=true><tab class=side-tab select=\"setState('faults')\" heading=REQUESTS></tab><tab class=side-tab select=\"setState('businesses')\" heading=BUSINESSES></tab><tab class=side-tab select=\"setState('trucks')\" heading=TRUCKS></tab></tabset><input ng-model=query.$ class=\"form-control input-box\"></div><div class=scroll-parent ng-class=\"(activeState == 'faults' ? 'half' : 'full')\"><div class=scroll-child><div ng-switch=activeState><div ng-switch-when=faults><div class=fault-wrapper ng-repeat=\"fault in data.faults | orderBy:'date' | filter:{dispatched: false} | filter:query\"><span class=fault-type>{{fault.type}}</span><div class=fault-side ng-class=\"(fault.dispatched ? 'side-greyed' : 'side-white')\" ng-click=selectRequest(fault)>{{fault._business.name}}</div></div></div><div ng-switch-when=businesses><div ng-repeat=\"business in data.business | values | orderBy: 'name' | filter:query\"><div class=business-side ng-click=selectBusiness(business)>{{business.name}}</div></div></div><div ng-switch-when=trucks><div ng-repeat=\"truck in data.truck | values | orderBy: 'name' | filter:query\"><div class=business-side ng-click=selectTruck(truck)>{{truck.name}}</div></div></div></div></div></div><hr class=thin-hr ng-show=\"activeState == 'faults'\"><div class=scroll-parent ng-show=\"activeState == 'faults'\"><div class=scroll-child><div><div ng-repeat=\"fault in data.faults | orderBy:'date' | filter:{dispatched: true} | filter:query\"><div class=business-side ng-class=\"(fault.dispatched ? 'side-greyed' : 'side-white')\" ng-click=selectRequest(fault)>{{fault._business.name}}</div></div></div></div></div><a class=\"footer btn btn-block\" ng-click=showDoorbell()>SUBMIT FEEDBACK</a>"),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><header class=hero-unit id=banner><div class=container><h1>\'Allo, \'Allo!</h1><p class=lead>Kick-start your next web app with Angular Fullstack</p><img src=assets/images/d535427a.yeoman.png alt="I\'m Yeoman"></div></header><div class=container><div class=row><div class=col-lg-12><h1 class=page-header>Features:</h1><ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings"><li><a href=# tooltip={{thing.info}}>{{thing.name}}<button type=button class=close ng-click=deleteThing(thing)>&times;</button></a></li></ul></div></div><form class=thing-form><label>Syncs in realtime across clients</label><p class=input-group><input class=form-control placeholder="Add a new thing here." ng-model=newThing> <span class=input-group-btn><button type=submit class="btn btn-primary" ng-click=addThing()>Add New</button></span></p></form></div><footer class=footer><div class=container><p>Angular Fullstack v2.0.13 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>att-capstone</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);